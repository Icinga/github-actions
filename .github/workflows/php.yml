# This file defines a reusable GitHub Actions workflow for Icinga PHP modules and libraries.
# It runs linting, unit tests and static analysis across multiple PHP versions.

on:
  workflow_call:
    inputs:
      php-versions:
        type: string
        description: 'PHP versions to test against, JSON encoded array of strings.'
        default: '["8.2", "8.3", "8.4"]'
      php-extensions:
        type: string
        description: 'PHP extensions to install, comma separated list of strings.'
      dependencies:
        type: string
        description: 'Dependencies to install, JSON encoded map of path => repository url.'
        default: '{}'

# Prevent multiple runs of the same workflow from overlapping on the same branch/PR.
concurrency:
  group: ${{ github.repository }}-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    name: Lint
    strategy:
      matrix:
        php: ${{ fromJson(inputs.php-versions) }}
    uses: ./.github/workflows/phplint.yml
    with:
      php-version: ${{ matrix.php }}
